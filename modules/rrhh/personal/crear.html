<!-- desktop/modules/rrhh/crear.html -->
<div class="formulario-rrhh">
  <h2 style="color: #1a365d; margin-bottom: 20px; font-size: 22px;">âœ… Crear Empleado</h2>

  <div style="text-align: center; margin-bottom: 24px;">
    <div style="
      width: 120px;
      height: 160px;
      background-color: #e0e0e0;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin: 0 auto;
      overflow: hidden;
      cursor: pointer;
      position: relative;
    " onclick="document.getElementById('foto-input').click();">
      <img id="foto-preview" src="" style="display:none; width:100%; height:100%; object-fit:cover;" />
      <svg id="foto-icono" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2" style="display:block;">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      <span style="font-size: 12px; color: #2b6cb0; margin-top: 6px;">Elegir foto</span>
      <input type="file" id="foto-input" accept="image/*" style="display:none;">
    </div>
  </div>

  <div class="rrhh-form">
    <div class="rrhh-row">
      <div class="rrhh-input-group">
        <label class="rrhh-label">Nombres *</label>
        <input type="text" class="rrhh-input" id="nombres" placeholder="Juan">
      </div>
      <div class="rrhh-input-group">
        <label class="rrhh-label">Apellidos *</label>
        <input type="text" class="rrhh-input" id="apellidos" placeholder="PÃ©rez">
      </div>
    </div>

    <div class="rrhh-input-group">
      <label class="rrhh-label">IdentificaciÃ³n *</label>
      <input type="text" class="rrhh-input" id="identificacion" placeholder="001-010190-0000A" maxlength="16" title="Formato: ###-DDMMYY-####L (14 caracteres sin guiones)">
    </div>

    <div class="rrhh-input-group">
      <label class="rrhh-label">Edad</label>
      <input type="text" class="rrhh-input rrhh-readonly" id="edad" readonly>
    </div>

    <div class="rrhh-row">
      <div class="rrhh-input-group" style="flex: 1;">
        <label class="rrhh-label">DÃ­a</label>
        <select class="rrhh-select" id="nac-dia">
          <option value="">DÃ­a</option>
        </select>
      </div>
      <div class="rrhh-input-group" style="flex: 1;">
        <label class="rrhh-label">Mes</label>
        <select class="rrhh-select" id="nac-mes">
          <option value="">Mes</option>
        </select>
      </div>
      <div class="rrhh-input-group" style="flex: 1.5;">
        <label class="rrhh-label">AÃ±o</label>
        <select class="rrhh-select" id="nac-ano">
          <option value="">AÃ±o</option>
        </select>
      </div>
    </div>

    <div class="rrhh-row">
      <div class="rrhh-input-group">
        <label class="rrhh-label">TelÃ©fono 1 *</label>
        <input type="text" class="rrhh-input" id="telefono1" value="+505" placeholder="+505">
      </div>
      <div class="rrhh-input-group">
        <label class="rrhh-label">TelÃ©fono 2</label>
        <input type="text" class="rrhh-input" id="telefono2" value="+505" placeholder="+505">
      </div>
    </div>
    <div class="rrhh-input-group">
      <label class="rrhh-label">Correo ElectrÃ³nico</label>
      <input type="email" class="rrhh-input" id="email" placeholder="ejemplo@correo.com">
    </div>

    <div class="rrhh-row">
      <div class="rrhh-input-group">
        <label class="rrhh-label">Puesto *</label>
        <select class="rrhh-select" id="puesto">
          <option>Jefe de Operaciones</option>
          <option>Supervisor de Operaciones</option>
          <option>TÃ©cnico Audiovisual</option>
          <option>Ayudante de Audio Visual</option>
          <option>Armador A</option>
          <option>Armador B</option>
          <option>Ayudante</option>
          <option>Bodeguero</option>
          <option>Contador</option>
          <option>Asistente</option>
          <option>Ventas</option>
          <option>Comprador</option>
          <option>Soldador</option>
          <option>Otro</option>
        </select>
      </div>
      <div class="rrhh-input-group">
        <label class="rrhh-label">Estatus</label>
        <select class="rrhh-select" id="estatus">
          <option>Fijo</option>
          <option>Eventual</option>
        </select>
      </div>
    </div>

    <div id="fecha-ingreso-container" style="display: none; margin-top: 16px;">
      <label class="rrhh-label">Fecha de Ingreso *</label>
      <div class="rrhh-row">
        <div class="rrhh-input-group" style="flex: 1;">
          <label class="rrhh-label-small">DÃ­a</label>
          <select class="rrhh-select" id="ing-dia">
            <option value="">DÃ­a</option>
          </select>
        </div>
        <div class="rrhh-input-group" style="flex: 1;">
          <label class="rrhh-label-small">Mes</label>
          <select class="rrhh-select" id="ing-mes">
            <option value="">Mes</option>
          </select>
        </div>
        <div class="rrhh-input-group" style="flex: 1.5;">
          <label class="rrhh-label-small">AÃ±o</label>
          <select class="rrhh-select" id="ing-ano">
            <option value="">AÃ±o</option>
          </select>
        </div>
      </div>
    </div>

    <div class="rrhh-input-group">
      <label class="rrhh-label">Estado Civil</label>
      <select class="rrhh-select" id="estado-civil">
        <option>Soltero(a)</option>
        <option>Casado(a)</option>
        <option>Divorciado(a)</option>
        <option>Viudo(a)</option>
        <option>UniÃ³n Libre</option>
      </select>
    </div>

    <div class="rrhh-input-group">
      <label class="rrhh-label" id="salario-label">Salario *</label>
      <input type="text" class="rrhh-input" id="salario" placeholder="0.00">
    </div>

    <div class="rrhh-checkbox-row">
      <label class="rrhh-checkbox-container">
        <input type="checkbox" id="tiene-licencia">
        <span class="rrhh-checkmark"></span>
        Â¿Tiene licencia de conducir?
      </label>
    </div>
    <div id="licencia-detalles" style="display: none; margin-top: 12px;">
      <div class="rrhh-input-group">
        <label class="rrhh-label">CategorÃ­a</label>
        <select class="rrhh-select" id="categoria-licencia">
          <option value="">Sin licencia</option>
          <!-- Licencias ordinarias (O) -->
          <option value="O-1">O-1 Â· Motocicleta</option>
          <option value="O-2">O-2 Â· Motocicleta y automÃ³vil</option>
          <option value="O-3">O-3 Â· Motocicleta, automÃ³vil y camiÃ³n liviano</option>
          <option value="O-12">O-12 Â· Motocicleta y automÃ³vil (ampliada)</option>
          <option value="O-123">O-123 Â· Motocicleta, automÃ³vil y camiÃ³n</option>
          <!-- Licencias particulares / profesionales (P) -->
          <option value="P-1">P-1 Â· AutomÃ³vil particular</option>
          <option value="P-2">P-2 Â· Transporte pÃºblico liviano</option>
          <option value="P-3">P-3 Â· Transporte pesado</option>
          <option value="P-4A">P-4A Â· CamiÃ³n pesado</option>
          <option value="P-4B">P-4B Â· Cabezal / trÃ¡iler</option>
        </select>
      </div>
      <label class="rrhh-label">Vencimiento</label>
      <div class="rrhh-row">
        <div class="rrhh-input-group" style="flex: 1;">
          <label class="rrhh-label-small">DÃ­a</label>
          <select class="rrhh-select" id="ven-dia">
            <option value="">DÃ­a</option>
          </select>
        </div>
        <div class="rrhh-input-group" style="flex: 1;">
          <label class="rrhh-label-small">Mes</label>
          <select class="rrhh-select" id="ven-mes">
            <option value="">Mes</option>
          </select>
        </div>
        <div class="rrhh-input-group" style="flex: 1.5;">
          <label class="rrhh-label-small">AÃ±o</label>
          <select class="rrhh-select" id="ven-ano">
            <option value="">AÃ±o</option>
          </select>
        </div>
      </div>
    </div>

    <div class="rrhh-checkbox-row">
      <label class="rrhh-checkbox-container">
        <input type="checkbox" id="tiene-seguro">
        <span class="rrhh-checkmark"></span>
        Â¿Tiene Seguro Social?
      </label>
    </div>
    <div id="seguro-detalles" style="display: none; margin-top: 12px;">
      <div class="rrhh-input-group">
        <label class="rrhh-label">NÃºmero</label>
        <input type="text" class="rrhh-input" id="numero-seguro" placeholder="000-00-0000">
      </div>
    </div>

    <div class="rrhh-input-group">
      <label class="rrhh-label">DirecciÃ³n</label>
      <textarea class="rrhh-input rrhh-textarea" id="direccion" placeholder="DirecciÃ³n completa" rows="2"></textarea>
    </div>
    <div class="rrhh-input-group">
      <label class="rrhh-label">Observaciones</label>
      <textarea class="rrhh-input rrhh-textarea" id="observaciones" placeholder="Notas adicionales" rows="3"></textarea>
    </div>

    <div class="rrhh-button-row">
      <button class="rrhh-button rrhh-save">Guardar</button>
      <button class="rrhh-button rrhh-new">Nuevo</button>
    </div>
  </div>
</div>

<style>
.rrhh-form { padding: 0 16px; }
.rrhh-row { display: flex; justify-content: space-between; gap: 12px; margin: 8px 0; }
.rrhh-input-group { flex: 1; margin: 6px 0; }
.rrhh-label { display: block; font-size: 14px; font-weight: 600; color: #1a365d; margin-bottom: 4px; }
.rrhh-label-small { display: block; font-size: 12px; font-weight: 600; color: #1a365d; margin-bottom: 4px; }
.rrhh-input, .rrhh-select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; min-height: 50px; box-sizing: border-box; }
.rrhh-textarea { padding-top: 12px; resize: vertical; }
.rrhh-readonly { background-color: #f9f9f9; color: #666; }
.rrhh-checkbox-row { margin: 14px 0; }
.rrhh-checkbox-container { display: flex; align-items: center; font-size: 14px; color: #2d3748; cursor: pointer; }
.rrhh-checkbox-container input { display: none; }
.rrhh-checkmark { display: inline-block; width: 20px; height: 20px; border: 2px solid #2b6cb0; border-radius: 4px; background-color: #2b6cb0; margin-right: 10px; display: flex; justify-content: center; align-items: center; color: white; }
.rrhh-checkbox-container input:checked + .rrhh-checkmark::after { content: "âœ“"; font-size: 14px; }
.rrhh-button-row { display: flex; justify-content: center; gap: 20px; margin-top: 24px; }
.rrhh-button { padding: 12px 24px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; color: white; cursor: pointer; min-width: 120px; }
.rrhh-save { background-color: #2b6cb0; }
.rrhh-new { background-color: #6c757d; }
</style>

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="../../src/config/supabaseClient.js"></script>

<script>
// === COMPRESIÃ“N DE IMAGEN ===
async function compressImage(file, maxWidth = 800, quality = 0.7) {
  return new Promise((resolve) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    img.onload = () => {
      const scaleFactor = maxWidth / img.width;
      const newWidth = maxWidth;
      const newHeight = Math.round(img.height * scaleFactor);
      canvas.width = newWidth;
      canvas.height = newHeight;
      ctx.drawImage(img, 0, 0, newWidth, newHeight);
      canvas.toBlob(resolve, 'image/jpeg', quality);
    };
    img.src = URL.createObjectURL(file);
  });
}

// === OBTENER PRÃ“XIMO CÃ“DIGO DE EMPLEADO ===
async function obtenerSiguienteCodigoEmpleado() {
  const { data, error } = await supabaseClient
    .from('empleados')
    .select('codigo_empleado', { count: 'exact' })
    .order('codigo_empleado', { ascending: false })
    .limit(1);

  if (error) throw error;
  if (!data || data.length === 0) return 'EMP-0001';

  const ultimoCodigo = data[0].codigo_empleado;
  const match = ultimoCodigo.match(/^EMP-(\d+)$/);
  if (match) {
    const num = parseInt(match[1], 10) + 1;
    return `EMP-${String(num).padStart(4, '0')}`;
  }
  return 'EMP-0001';
}

// === GUARDAR EMPLEADO EN SUPABASE ===
async function guardarEmpleadoSupabase(empleado) {
  let fotoUrl = null;
  if (empleado.fotoBase64) {
    try {
      const res = await fetch(empleado.fotoBase64);
      const blob = await res.blob();
      const file = new File([blob], 'foto.jpg', { type: 'image/jpeg' });
      const compressedFile = await compressImage(file);
      const fileName = `empleados-fotos/${empleado.codigo_empleado}.jpg`;

      const { error: uploadError } = await supabaseClient
        .storage
        .from('empleados-fotos')
        .upload(fileName, compressedFile);

      if (uploadError) throw uploadError;

      const {  publicData } = supabaseClient
        .storage
        .from('empleados-fotos')
        .getPublicUrl(fileName);

      fotoUrl = publicData?.publicUrl || null;
    } catch (err) {
      console.warn('No se pudo subir la foto:', err.message);
    }
  }

  // Convertir fechas a YYYY-MM-DD
  const fechaNacimiento = empleado.fechaNacimiento && empleado.fechaNacimiento.dia && empleado.fechaNacimiento.mes && empleado.fechaNacimiento.ano
    ? `${empleado.fechaNacimiento.ano}-${empleado.fechaNacimiento.mes.padStart(2, '0')}-${empleado.fechaNacimiento.dia.padStart(2, '0')}`
    : null;

  const fechaIngreso = empleado.fechaIngreso && empleado.fechaIngreso.dia && empleado.fechaIngreso.mes && empleado.fechaIngreso.ano
    ? `${empleado.fechaIngreso.ano}-${empleado.fechaIngreso.mes.padStart(2, '0')}-${empleado.fechaIngreso.dia.padStart(2, '0')}`
    : null;

  const vencimientoLicencia = empleado.licencia && empleado.licencia.vencimiento && empleado.licencia.vencimiento.dia && empleado.licencia.vencimiento.mes && empleado.licencia.vencimiento.ano
    ? `${empleado.licencia.vencimiento.ano}-${empleado.licencia.vencimiento.mes.padStart(2, '0')}-${empleado.licencia.vencimiento.dia.padStart(2, '0')}`
    : null;

  const { error } = await supabaseClient
    .from('empleados')
    .insert([{
      codigo_empleado: empleado.codigo_empleado,
      nombres: empleado.nombres,
      apellidos: empleado.apellidos,
      identificacion: empleado.identificacion,
      edad: empleado.edad || null,
      fecha_nacimiento: fechaNacimiento,
      fecha_ingreso: fechaIngreso,
      vencimiento_licencia: vencimientoLicencia,
      telefono1: empleado.telefono1,
      telefono2: empleado.telefono2 || null,
      email: empleado.email || null,
      puesto: empleado.puesto,
      estatus: empleado.estatus,
      estado_civil: empleado.estadoCivil,
      salario: empleado.salario,
      tiene_licencia: empleado.tiene_licencia,
      categoria_licencia: empleado.categoria_licencia || null,
      tiene_seguro: empleado.tiene_seguro,
      numero_seguro: empleado.numero_seguro || null,
      direccion: empleado.direccion || null,
      observaciones: empleado.observaciones || null,
      foto_url: fotoUrl
    }]);

  if (error) throw error;
}

// === TU LÃ“GICA EXISTENTE (VALIDACIÃ“N, FECHAS, ETC.) SIN CAMBIOS ===
function previewFoto(event) {
  const file = event.target.files[0];
  const preview = document.getElementById('foto-preview');
  const icono = document.getElementById('foto-icono');
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.src = e.target.result;
      preview.style.display = 'block';
      icono.style.display = 'none';
    };
    reader.readAsDataURL(file);
  } else {
    preview.innerHTML = 'ðŸ“·';
    preview.style.display = 'flex';
    preview.style.alignItems = 'center';
    preview.style.justifyContent = 'center';
    icono.style.display = 'block';
  }
}

function llenarSelectsFecha() {
  const curr = new Date().getFullYear();
  const selects = {
    'nac-dia': { max: 31, start: 1, pad: true },
    'nac-mes': { max: 12, start: 1, pad: true },
    'nac-ano': { max: curr, start: curr - 100, pad: false, reverse: true },
    'ing-dia': { max: 31, start: 1, pad: true },
    'ing-mes': { max: 12, start: 1, pad: true },
    'ing-ano': { max: curr, start: curr - 30, pad: false, reverse: true },
    'ven-dia': { max: 31, start: 1, pad: true },
    'ven-mes': { max: 12, start: 1, pad: true },
    'ven-ano': { max: curr + 10, start: curr, pad: false, reverse: false }
  };
  for (const id in selects) {
    const sel = document.getElementById(id);
    if (sel) {
      const config = selects[id];
      let options = [];
      for (let i = config.start; i <= config.max; i++) {
        const val = config.pad ? i.toString().padStart(2, '0') : i.toString();
        options.push(`<option value="${val}">${val}</option>`);
      }
      if (config.reverse) options.reverse();
      sel.innerHTML += options.join('');
    }
  }
}

function validarCedula(cedula) {
  let clean = cedula.replace(/-/g, '').toUpperCase();
  if (clean.length !== 14) return { valido: false, mensaje: "Debe tener 14 caracteres." };
  if (!/^\d{13}[A-Z]$/.test(clean)) return { valido: false, mensaje: "Formato invÃ¡lido." };
  const birthPart = clean.substring(3, 9);
  const dia = parseInt(birthPart.slice(0, 2), 10);
  const mes = parseInt(birthPart.slice(2, 4), 10) - 1;
  const yy = parseInt(birthPart.slice(4, 6), 10);
  const now = new Date();
  const currentYY = now.getFullYear() % 100;
  const yyyy = yy <= currentYY ? 2000 + yy : 1900 + yy;
  const fecha = new Date(yyyy, mes, dia);
  const esValida = fecha.getFullYear() === yyyy && fecha.getMonth() === mes && fecha.getDate() === dia && dia >= 1 && dia <= 31 && mes >= 0 && mes <= 11;
  if (!esValida) return { valido: false, mensaje: "Fecha invÃ¡lida." };
  return { valido: true, edad: now.getFullYear() - yyyy, fechaNac: { dia: birthPart.slice(0, 2), mes: birthPart.slice(2, 4), aÃ±o: yyyy } };
}

function validarFormulario() {
  const campos = ['nombres', 'apellidos', 'identificacion', 'puesto', 'telefono1', 'salario'];
  for (const campo of campos) {
    const input = document.getElementById(campo);
    if (!input.value.trim()) {
      alert(`âš ï¸ El campo "${input.previousElementSibling.textContent.replace('*', '').trim()}" es obligatorio.`);
      input.focus();
      return false;
    }
  }
  const identInput = document.getElementById('identificacion').value.trim();
  if (!/^\d{3}-\d{6}-\d{4}[A-Z]$/.test(identInput)) {
    alert('âš ï¸ Formato de identificaciÃ³n invÃ¡lido. Use: ###-DDMMYY-####L');
    document.getElementById('identificacion').focus();
    return false;
  }
  const salario = parseFloat(document.getElementById('salario').value);
  if (isNaN(salario) || salario <= 0) {
    alert('âš ï¸ El salario debe ser un nÃºmero positivo.');
    document.getElementById('salario').focus();
    return false;
  }
  return true;
}

async function crearEmpleado() {
  if (!validarFormulario()) return;

  // Previsualizar foto
  let fotoBase64 = null;
  const previewImg = document.getElementById('foto-preview');
  if (previewImg && previewImg.src && previewImg.src.startsWith('image')) {
    fotoBase64 = previewImg.src;
  }

  const codigoEmpleado = await obtenerSiguienteCodigoEmpleado();

  const empleado = {
    codigo_empleado: codigoEmpleado,
    nombres: document.getElementById('nombres').value.trim(),
    apellidos: document.getElementById('apellidos').value.trim(),
    identificacion: document.getElementById('identificacion').value.trim(),
    edad: parseInt(document.getElementById('edad').value) || null,
    fechaNacimiento: {
      dia: document.getElementById('nac-dia').value,
      mes: document.getElementById('nac-mes').value,
      ano: document.getElementById('nac-ano').value
    },
    telefono1: document.getElementById('telefono1').value,
    telefono2: document.getElementById('telefono2').value,
    email: document.getElementById('email').value.trim(),
    puesto: document.getElementById('puesto').value,
    estatus: document.getElementById('estatus').value,
    fechaIngreso: document.getElementById('estatus').value === 'Fijo'
      ? {
          dia: document.getElementById('ing-dia').value,
          mes: document.getElementById('ing-mes').value,
          ano: document.getElementById('ing-ano').value
        }
      : null,
    estadoCivil: document.getElementById('estado-civil').value,
    salario: parseFloat(document.getElementById('salario').value),
    tiene_licencia: document.getElementById('tiene-licencia').checked,
    categoria_licencia: document.getElementById('tiene-licencia').checked ? document.getElementById('categoria-licencia').value : null,
    licencia: document.getElementById('tiene-licencia').checked
      ? {
          categoria: document.getElementById('categoria-licencia').value,
          vencimiento: {
            dia: document.getElementById('ven-dia').value,
            mes: document.getElementById('ven-mes').value,
            ano: document.getElementById('ven-ano').value
          }
        }
      : null,
    tiene_seguro: document.getElementById('tiene-seguro').checked,
    numero_seguro: document.getElementById('tiene-seguro').checked ? document.getElementById('numero-seguro').value : null,
    direccion: document.getElementById('direccion').value.trim(),
    observaciones: document.getElementById('observaciones').value.trim(),
    fotoBase64: fotoBase64
  };

  try {
    await guardarEmpleadoSupabase(empleado);
    alert(`âœ… Empleado guardado con Ã©xito.\nCÃ³digo: ${codigoEmpleado}`);
    // Mostrar notificaciÃ³n del sistema
    if (window.showSystemNotification) {
      window.showSystemNotification('Empleado Creado', `Empleado ${codigoEmpleado} registrado exitosamente.`);
    }
    resetFormulario();
  } catch (error) {
    console.error('Error al guardar:', error);
    alert('âŒ Error al guardar en Supabase: ' + error.message);
    // Mostrar notificaciÃ³n de error
    if (window.showSystemNotification) {
      window.showSystemNotification('Error al Crear Empleado', 'No se pudo registrar el empleado. Verifique los datos.');
    }
  }
}

function resetFormulario() {
  document.querySelectorAll('.rrhh-input, .rrhh-select, .rrhh-textarea').forEach(el => {
    if (el.type === 'checkbox') el.checked = false;
    else el.value = '';
  });
  document.getElementById('foto-preview').style.display = 'none';
  document.getElementById('foto-icono').style.display = 'block';
  document.getElementById('licencia-detalles').style.display = 'none';
  document.getElementById('seguro-detalles').style.display = 'none';
  document.getElementById('fecha-ingreso-container').style.display = 'none';
  document.getElementById('estatus').value = 'Fijo';
  document.getElementById('fecha-ingreso-container').style.display = 'block';
}

// === LÃ“GICA DE EVENTOS ===
function initCrearEmpleado() {
  console.log('âœ… Inicializando formulario de Crear Empleado');
  llenarSelectsFecha();

  const identInput = document.getElementById('identificacion');
  const estatusSelect = document.getElementById('estatus');
  const tieneLicencia = document.getElementById('tiene-licencia');
  const tieneSeguro = document.getElementById('tiene-seguro');
  const fotoInput = document.getElementById('foto-input');

  if (fotoInput) fotoInput.addEventListener('change', previewFoto);

  if (identInput) {
    identInput.addEventListener('blur', function() {
      const cedula = this.value.trim();
      const edadInput = document.getElementById('edad');
      const nacDia = document.getElementById('nac-dia');
      const nacMes = document.getElementById('nac-mes');
      const nacAno = document.getElementById('nac-ano');
      if (!cedula) {
        edadInput.value = '';
        nacDia.value = nacMes.value = nacAno.value = '';
        return;
      }
      const resultado = validarCedula(cedula);
      if (resultado.valido) {
        edadInput.value = resultado.edad.toString();
        nacDia.value = resultado.fechaNac.dia;
        nacMes.value = resultado.fechaNac.mes;
        nacAno.value = resultado.fechaNac.aÃ±o.toString();
      } else {
        alert('âš ï¸ ' + resultado.mensaje);
        edadInput.value = 'InvÃ¡lida';
        nacDia.value = nacMes.value = nacAno.value = '';
      }
    });
  }

  const fechaIngresoContainer = document.getElementById('fecha-ingreso-container');
  function toggleFechaIngreso() {
    fechaIngresoContainer.style.display = estatusSelect.value === 'Fijo' ? 'block' : 'none';
  }
  if (estatusSelect) {
    estatusSelect.addEventListener('change', toggleFechaIngreso);
    toggleFechaIngreso();
  }

  const salarioLabel = document.getElementById('salario-label');
  function actualizarEtiquetaSalario() {
    salarioLabel.textContent = estatusSelect.value === 'Fijo' ? 'Salario Mensual *' : 'Salario por DÃ­a de Evento *';
  }
  if (estatusSelect && salarioLabel) {
    estatusSelect.addEventListener('change', actualizarEtiquetaSalario);
    actualizarEtiquetaSalario();
  }

  const licenciaDetalles = document.getElementById('licencia-detalles');
  if (tieneLicencia) tieneLicencia.addEventListener('change', () => licenciaDetalles.style.display = tieneLicencia.checked ? 'block' : 'none');

  const seguroDetalles = document.getElementById('seguro-detalles');
  if (tieneSeguro) tieneSeguro.addEventListener('change', () => seguroDetalles.style.display = tieneSeguro.checked ? 'block' : 'none');

  document.querySelector('.rrhh-save').addEventListener('click', (e) => {
    e.preventDefault();
    crearEmpleado();
  });

  document.querySelector('.rrhh-new').addEventListener('click', (e) => {
    e.preventDefault();
    if (confirm('Â¿Desea limpiar el formulario?')) resetFormulario();
  });

  console.log('âœ… Formulario de Crear Empleado inicializado correctamente');
}

initCrearEmpleado(); 
</script>