<!-- desktop/modules/bodega/bodega.html -->
<link rel="stylesheet" href="./modules/bodega/bodega.css">
<script src="./modules/bodega/bodega.js"></script>
<div class="bodega-container">
  <!-- MenÃº lateral (misma estructura que otros mÃ³dulos) -->
  <div class="bodega-menu-lateral">
    <h3>ğŸ§© Audiovisual</h3>
    <button class="bodega-submenu-btn" data-vista="universal-agregar-electronicos">â• Agregar â€“ Materiales ElectrÃ³nicos</button>
    <button class="bodega-submenu-btn" data-vista="audiovisual-modificar">âœï¸ Modificar â€“ Contenedores / MÃ³dulos</button>

    <h3>ğŸ§± Hierros</h3>
    <button class="bodega-submenu-btn" data-vista="hierro-agregar">â• Agregar â€“ Hierros</button>
    <button class="bodega-submenu-btn" data-vista="hierro-modificar">âœï¸ Modificar â€“ Contenedores / Materiales</button>

    <h3>ğŸ§© Universal</h3>

    <button class="bodega-submenu-btn" data-vista="universal-agregar-consumibles">â• Agregar â€“ Consumibles</button>
    <button class="bodega-submenu-btn" data-vista="universal-modificar-consumibles">âœï¸ Modificar â€“ Consumibles</button>
    <button class="bodega-submenu-btn" data-vista="universal-ficha-etiqueta">ğŸªª Ficha y Etiqueta</button>

    <h3>ğŸšš Movimientos</h3>
    <button class="bodega-submenu-btn" data-vista="movimientos-ingreso">ğŸ“¥ Ingreso</button>
    <button class="bodega-submenu-btn" data-vista="movimientos-fabricacion">ğŸ› ï¸ FabricaciÃ³n</button>
    <button class="bodega-submenu-btn" data-vista="movimientos-devolucion">ğŸ”„ DevoluciÃ³n</button>
    <button class="bodega-submenu-btn" data-vista="movimientos-despachobodega">ğŸ“¤ Despacho</button>
    <button class="bodega-submenu-btn" data-vista="movimientos-ventasmateriales">ğŸ’¸ Ventas</button>
    <button class="bodega-submenu-btn" data-vista="movimientos-bajasmateriales">ğŸ“‰ Bajas</button>

    <h3>ğŸ“Š Exportar Datos</h3>
    <button class="bodega-submenu-btn" onclick="exportarBodegaAExcel()">ğŸ“Š Exportar Bodega a Excel</button>
  </div>

  <!-- Ãrea dinÃ¡mica -->
  <div class="bodega-area-dinamica">
    <!-- Wrapper para compatibilidad con bodega.js (aquÃ­ se inyectan vistas no-dashboard) -->
    <div class="bodega-area-contenido">
      <div class="bodega-encabezado">
        <h1 class="bodega-titulo">ğŸ“¦ MÃ³dulo de Bodega</h1>
        <p class="bodega-subtitulo">Sala de Control â€“ GestiÃ³n de inventario, movimientos y trazabilidad</p>
      </div>

      <div class="bodega-dashboard-top">
        <div class="bodega-kpis">
          <div class="bodega-kpi-card">
            <div class="bodega-kpi-label">Ãtems en catÃ¡logo</div>
            <div class="bodega-kpi-value">â€”</div>
            <div class="bodega-kpi-hint">Se actualiza al abrir reportes</div>
          </div>
          <div class="bodega-kpi-card">
            <div class="bodega-kpi-label">Stock bajo</div>
            <div class="bodega-kpi-value">â€”</div>
            <div class="bodega-kpi-hint">Revisa â€œPor Ãtemâ€</div>
          </div>
          <div class="bodega-kpi-card">
            <div class="bodega-kpi-label">Movimientos</div>
            <div class="bodega-kpi-value">â€”</div>
            <div class="bodega-kpi-hint">Hoy / semana</div>
          </div>
          <div class="bodega-kpi-card">
            <div class="bodega-kpi-label">Vista activa</div>
            <div class="bodega-kpi-value">Dashboard</div>
            <div class="bodega-kpi-hint">Cambia con las pestaÃ±as</div>
          </div>
        </div>

        <div class="bodega-atajos">
          <div class="bodega-atajos-titulo">Accesos rÃ¡pidos</div>
          <div class="bodega-atajos-grid">
            <button class="bodega-atajo-btn" data-vista="movimientos-ingreso">ğŸ“¥ Nuevo Ingreso</button>
            <button class="bodega-atajo-btn" data-vista="movimientos-despachobodega">ğŸ“¤ Nuevo Despacho</button>
            <button class="bodega-atajo-btn" data-vista="universal-agregar-electronicos">â• Agregar (ElectrÃ³nicos)</button>
          </div>
        </div>
      </div>

      <div class="bodega-dashboard">
        <div class="bodega-tabs">
          <button class="bodega-tab-btn active" data-vista="dashboard-xbodega">ğŸ“¦ Por Bodega</button>
          <button class="bodega-tab-btn" data-vista="dashboard-xitem">ğŸ“Š Por Ãtem</button>
          <button class="bodega-tab-btn" data-vista="dashboard-xevento">ğŸª Por Evento</button>
          <button class="bodega-tab-btn" data-vista="dashboard-xproveedor">ğŸ¢ Por Proveedor</button>
        </div>

        <div class="bodega-tab-content" id="bodega-tab-panel">
          <p style="color: #ccc;">Cargando vista de inventario por bodega...</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- SCRIPT DIRECTO (NO SE CARGA CON SAFELOAD) -->
<script>
// === LÃ“GICA DIRECTA DEL DASHBOARD (EJECUTA INMEDIATAMENTE) ===
document.addEventListener('DOMContentLoaded', () => {
  // Cargar vista inicial: xbodega
  cargarVistaDashboard('dashboard-xbodega');

  // Eventos de pestaÃ±as del dashboard
  document.querySelectorAll('.bodega-tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      // Actualizar clase 'active'
      document.querySelectorAll('.bodega-tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      // Cargar vista
      cargarVistaDashboard(btn.dataset.vista);
    });
  });

  // Los botones del menÃº lateral ya estÃ¡n manejados por la delegaciÃ³n de eventos en bodega.js
});

// === FUNCIONES DE CARGA ===
function cargarVistaDashboard(vista) {
  // SimulaciÃ³n: por ahora solo muestra el nombre
  const panel = document.getElementById('bodega-tab-panel');
  panel.innerHTML = `<p style="color: #aaa;">Cargando vista: ${vista}...</p>`;

  // Enviar evento FALSO al sistema de bodega.js
  const eventoFake = {
    target: {
      dataset: { vista }
    }
  };

  // Reusar la lÃ³gica de bodega.js â†’ PERO DEBES TENER ESTA FUNCIÃ“N GLOBAL
  if (typeof manejarClicVista === 'function') {
    manejarClicVista(eventoFake);
  } else {
    // Fallback: mensaje claro
    panel.innerHTML = `<p style="color: red;">Error: sistema de carga no disponible.</p>`;
  }
}
</script>